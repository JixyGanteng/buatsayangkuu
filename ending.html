<!DOCTYPE html>
<html>
<head>
  <title>Happy Birthday</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

<div class="container">
  <div class="cake">
    <div class="candle">
      <div class="flame" id="flame"></div>
    </div>
  </div>

  <h1 id="text"></h1>
  <p>Coba deh tiup lilinya ðŸŽ‚</p>
</div>

<script src="script.js"></script>

<script>
typeEffect(
  document.getElementById("text"),
  "Happy Birthday Sayang ðŸ¤",
  80
);

setTimeout(() => {
  confetti({
    particleCount: 120,
    spread: 70,
    origin: { y: 0.6 }
  });
}, 800);

navigator.mediaDevices.getUserMedia({ audio: true })
.then(stream => {
  const audioContext = new AudioContext();
  const mic = audioContext.createMediaStreamSource(stream);
  const analyser = audioContext.createAnalyser();
  mic.connect(analyser);

  const data = new Uint8Array(analyser.frequencyBinCount);

  function detectBlow() {
    analyser.getByteFrequencyData(data);
    let volume = data.reduce((a,b)=>a+b) / data.length;

    if(volume > 60){
      document.getElementById("flame").style.display = "none";

      confetti({
        particleCount: 200,
        spread: 100,
        origin: { y: 0.6 }
      });

      stream.getTracks().forEach(track => track.stop());
    }

    requestAnimationFrame(detectBlow);
  }

  detectBlow();
});
</script>

<style>
.cake {
  position: relative;
  width: 120px;
  height: 80px;
  background: #ff6b81;
  border-radius: 10px;
  margin: 0 auto 25px auto;
  box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

.cake::before {
  content: "";
  position: absolute;
  top: -20px;
  left: 10px;
  right: 10px;
  height: 25px;
  background: #ffc0cb;
  border-radius: 10px;
}

.candle {
  position: absolute;
  top: -50px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 40px;
  background: white;
  border-radius: 5px;
}

.flame {
  position: absolute;
  top: -18px;
  left: 50%;
  transform: translateX(-50%);
  width: 14px;
  height: 18px;
  background: orange;
  border-radius: 50%;
  animation: flicker 0.2s infinite alternate;
}

@keyframes flicker {
  from { transform: translateX(-50%) scale(1); opacity: 1; }
  to { transform: translateX(-50%) scale(1.1); opacity: 0.8; }
}
</style>

</body>
</html>
